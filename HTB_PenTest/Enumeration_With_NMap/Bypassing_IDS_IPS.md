## NMAP PERFORMANCE - !!IMPORTANCE!! (Bypassing IDS/IPS)
**Timing Templates (-T <0-5>)**:
The most straightforward way to control scan speed is using timing templates:
	-T0 (Paranoid): Use when absolute stealth is required and detection must be avoided 
	-T1 (Sneaky): For thorough scans requiring minimal detection risk 
	-T2 (Polite): When scanning while trying to minimize network load 
	-T3 (Normal): Default timing - balanced between accuracy and speed
	 -T4 (Aggressive): When scanning modern and reliable networks 
	 -T5 (Insane): When speed is critical and you're on a fast, reliable network

**RTT Timeouts**:
Round-Trip-Time settings are crucial for optimizing scan accuracy and speed:
	--initial-rtt-timeout: Controls the starting timeout for probe responses 
	--max-rtt-timeout: Sets the maximum waiting time for responses 
	--min-rtt-timeout: Defines minimum waiting time

For example, reducing RTT timeouts (like --initial-rtt-timeout 50ms --max-rtt-timeout 100ms) can speed up scans significantly but may miss some hosts. Use these optimizations when:
- Scanning known reliable networks
- Time constraints are significant
- Missing a small percentage of hosts is acceptable

**Rate Controls**:
These options help manage how aggressively Nmap sends packets:
	--min-rate: Forces Nmap to send no slower than X packets per second 
	--max-rate: Caps the sending rate 
	--min-parallelism: Sets minimum number of parallel probes 
	--max-parallelism: Limits parallel operations

**Retry and Timeout Controls**:
These settings affect how persistently Nmap probes targets:
	--max-retries: Controls number of probe retransmissions (default: 10) 
	--host-timeout: Abandons slow hosts after specified time 
	--scan-delay: Adds delay between probes

### Example Scenarios
**Internal Network Assessment Scenario:** 
	You're conducting an internal pentest of a large corporate network with over 1000 hosts, and you have 2 days to complete the assessment. Command: `nmap -T4 -F --min-rate 300 10.0.0.0/16 -oN internal_scan` Reasoning: In internal networks with reliable infrastructure, you can be more aggressive. The -T4 template and higher min-rate speed up scanning without significant risk of missing hosts. The -F flag limits to top 100 ports to maintain speed.

**Stealth External Assessment Scenario:** 
	You're performing an external assessment where staying under IDS/IPS radar is critical. Command: `nmap -T2 --max-retries 1 --initial-rtt-timeout 100ms --max-rtt-timeout 300ms 192.168.1.0/24` Reasoning: The slower T2 timing and limited retries help avoid triggering security alerts. Conservative RTT timeouts reduce network noise while maintaining reasonable accuracy.

**Low-Bandwidth Remote Site Scenario:** 
	You're assessing a remote office connected via a slow WAN link. Command: `nmap -T3 --scan-delay 500ms --max-parallelism 10 172.16.0.0/24` Reasoning: The scan delay prevents overwhelming the slow connection. Limited parallelism ensures stable scanning without packet loss. T3 timing provides balanced performance.

**Critical Infrastructure Scan Scenario:**
	You're scanning sensitive infrastructure like medical devices or industrial control systems. Command: `nmap -T2 --initial-rtt-timeout 200ms --max-retries 2 --min-parallelism 1 --scan-delay 1s 192.168.100.0/24` Reasoning: Conservative settings prevent disrupting critical services. Higher timeouts and scan delays ensure careful probing. Limited retries and parallelism minimize impact.

**Quick Asset Discovery Scenario:** 
	You need to quickly identify live hosts during an incident response. Command: `nmap -T5 --min-rate 1000 --max-retries 0 -n -Pn 10.10.0.0/16` Reasoning: Maximum speed settings with T5 and high min-rate. Skip DNS resolution (-n) and host discovery (-Pn) for pure port scanning. Zero retries prioritize speed over completeness.

## IP Spoofing / Decoy
Decoy is just using different IP addresses so that we are not detected. This can be done by randomization or manually select an IP.

The latter is important since there's might be a chance that a paritcular subnet is allowed but others are not.

```shell-session
lakin2504@htb[/htb]$ sudo nmap 10.129.2.28 -p 80 -sS -Pn -n --disable-arp-ping --packet-trace -D RND:5

Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-21 16:14 CEST
SENT (0.0378s) TCP 102.52.161.59:59289 > 10.129.2.28:80 S ttl=42 id=29822 iplen=44  seq=3687542010 win=1024 <mss 1460>
SENT (0.0378s) TCP 10.10.14.2:59289 > 10.129.2.28:80 S ttl=59 id=29822 iplen=44  seq=3687542010 win=1024 <mss 1460>
SENT (0.0379s) TCP 210.120.38.29:59289 > 10.129.2.28:80 S ttl=37 id=29822 iplen=44  seq=3687542010 win=1024 <mss 1460>
SENT (0.0379s) TCP 191.6.64.171:59289 > 10.129.2.28:80 S ttl=38 id=29822 iplen=44  seq=3687542010 win=1024 <mss 1460>
SENT (0.0379s) TCP 184.178.194.209:59289 > 10.129.2.28:80 S ttl=39 id=29822 iplen=44  seq=3687542010 win=1024 <mss 1460>
SENT (0.0379s) TCP 43.21.121.33:59289 > 10.129.2.28:80 S ttl=55 id=29822 iplen=44  seq=3687542010 win=1024 <mss 1460>
RCVD (0.1370s) TCP 10.129.2.28:80 > 10.10.14.2:59289 SA ttl=64 id=0 iplen=44  seq=4056111701 win=64240 <mss 1460>
Nmap scan report for 10.129.2.28
Host is up (0.099s latency).

PORT   STATE SERVICE
80/tcp open  http
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 0.15 seconds
```


```shell-session
alakin2504@htb[/htb]$ sudo nmap 10.129.2.28 -n -Pn -p 445 -O -S 10.129.2.200 -e tun0

Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-22 01:16 CEST
Nmap scan report for 10.129.2.28
Host is up (0.010s latency).

PORT    STATE SERVICE
445/tcp open  microsoft-ds
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.4 - 3.10 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Synology DiskStation Manager 5.2-5644 (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 1 hop

OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 4.11 seconds
```


|                      |                                                                                            |
| -------------------- | ------------------------------------------------------------------------------------------ |
| `10.129.2.28`        | Scans the specified target.                                                                |
| `-p 80`              | Scans only the specified ports.                                                            |
| `-sS`                | Performs SYN scan on specified ports.                                                      |
| `-Pn`                | Disables ICMP Echo requests.                                                               |
| `-n`                 | Disables DNS resolution.                                                                   |
| `--disable-arp-ping` | Disables ARP ping.                                                                         |
| `--packet-trace`     | Shows all packets sent and received.                                                       |
| `-D RND:5`           | Generates five random IP addresses that indicates the source IP the connection comes from. |
| -O                   | Scans the OS                                                                               |
| -S                   | Specify the fake IP                                                                        |
| -e tun0              | The target's interface                                                                     |


## DNS Proxying
1. DNS Resolution & Default Behavior:

- When you type a website name like "google.com", DNS converts it to an IP address
- By default, Nmap does the reverse - it takes IP addresses and tries to find their domain names
- This happens over UDP port 53 (like a quick phone call)
- Sometimes TCP port 53 is used (like a longer phone conversation), especially with newer tech like IPv6

2. The Cool Part About DNS Servers:

- Nmap lets you pick which DNS server to use with `--dns-server`
- This is super useful in corporate networks (DMZ = special network zone between internal and external networks)
- Company DNS servers are usually "trusted" more than internet ones
- If you use these trusted servers, you might get more info about internal networks

3. The Sneaky Bit:

- You can make your scan look like it's coming from TCP port 53
- Some lazy firewall setups might just let this traffic through because they assume DNS traffic is always safe
- This is actually a common security mistake administrators make

```shell-session
alakin2504@htb[/htb]$ sudo nmap 10.129.2.28 -p50000 -sS -Pn -n --disable-arp-ping --packet-trace --source-port 53

SENT (0.0482s) TCP 10.10.14.2:53 > 10.129.2.28:50000 S ttl=58 id=27470 iplen=44  seq=4003923435 win=1024 <mss 1460>
RCVD (0.0608s) TCP 10.129.2.28:50000 > 10.10.14.2:53 SA ttl=64 id=0 iplen=44  seq=540635485 win=64240 <mss 1460>
Nmap scan report for 10.129.2.28
Host is up (0.013s latency).

PORT      STATE SERVICE
50000/tcp open  ibm-db2
MAC Address: DE:AD:00:00:BE:EF (Intel Corporate)

Nmap done: 1 IP address (1 host up) scanned in 0.08 seconds
```

|`--source-port 53`|Performs the scans from specified source port.|